<div
  class="content-shadow bg-white mb-5"
  not-authorized
  [notAuthorized]="isNotAuthorized"
>


  <h2 class="size-body title-with-btn plr-4 ptb-4">
    <span class="page-title">{{ "tr_orders" | translate }}</span>
    <div class="btn-group">
      <button class="s-btn btn-primary" (click)="createOrEditOrder(false)">
        {{ "tr_add_invoice" | translate }}
      </button>
      <button
        class="s-btn btn-secondary size-body"
        (click)="isFilterOpen = !isFilterOpen"
      >
        <i class="fa fa-filter text-primary" aria-hidden="false"></i>
      </button>
    </div>
  </h2>

  <div class="filters-card bg-secondary mtb-2 plr-4 ptb-4" *ngIf="isFilterOpen">
    <div >
  
      <div class="row">
        <div class="form-group col-md-3">
          <label for="">{{'tr_from' | translate}}</label>
          <div class="input-with-icon">
              <input [(ngModel)]="fromDate"  (dateChange)="getOrderStatistics()"
                  placeholder="{{'tr_pick_date' | translate}}"  [matDatepicker]="pickId" class="s-control bg-white">
              <mat-datepicker #pickId></mat-datepicker>
              <mat-datepicker-toggle class="input-icon date-picker" [for]="pickId">
              </mat-datepicker-toggle>
          </div>
      </div>
      <div class="form-group col-md-3">
          <label for="">{{'tr_to' | translate}}</label>
          <div class="input-with-icon">
              <input [(ngModel)]="toDate"
                  placeholder="{{'tr_pick_date' | translate}}" [matDatepicker]="pickId2" class="s-control bg-white" (dateChange)="getOrderStatistics()">
              <mat-datepicker #pickId2></mat-datepicker>
              <mat-datepicker-toggle class="input-icon date-picker" [for]="pickId2">
              </mat-datepicker-toggle>
          </div>
      </div>
      <div class="col-md-4" *ngIf="curentUser.role == 'Super Admin'">
        <div
          class="form-group"
        >
          <label>{{ 'tr_branches' | translate }}</label>
          <div class="input-with-icon bg-white">
            <ng-select
              class="s-control s-select"
              placeholder="{{ 'tr_select' | translate }}"
              bindLabel="name"
              bindValue="_id"
              [clearable]="false"
              [(ngModel)]= "selectedBranchId"
              #branch="ngModel"
              name="branchId"
              [items]="branches"
              (change)="getOrderStatistics()"
              required
            >
            </ng-select>
            <i class="fa fa-caret-down input-icon"></i>
          </div>
        </div>
      </div>

      <div class="col-md-3">
        <div class="flex flex-middle mt-4">
          <div class="bg-light-success text-success border-success border rounded-100 size-small ptb-3 plr-3">
            <i class="fa fa-users"></i>
          </div>
          <div class="ml-2">
            <a class="hover-link pointer weight-bold" >
              <span class="text-primary">   {{orderStatistics?.totalInvoices}} </span>
           
              {{ 'tr_total_number_of_invoices' | translate }} </a>
            <div class="size-small mtb-1 steel weight-bold">{{fromDate | date: 'dd/M/YYYY'}} {{'tr_to' | translate}} {{toDate | date: 'dd/M/YYYY'}}</div>
          </div>
        </div>
      </div>
      <div class="col-md-3">

        <div class="flex flex-middle mt-4">
          <div class="bg-secondary text-primary border rounded-100 size-small ptb-3 plr-3">
            <i class="fa fa-calendar"></i>
          </div>
          <div class="ml-2">
            <a class="hover-link pointer weight-bold" >
              <span class="text-primary">   {{orderStatistics?.totalSales | currency:'EGP':'symbol':'1.2-2':'en-EG' }} </span>
              {{ 'tr_total_amount' | translate}}
             </a>
            <div class="size-small mtb-1 steel weight-bold">{{fromDate | date: 'dd/M/YYYY'}} {{'tr_to' | translate}} {{toDate | date: 'dd/M/YYYY'}}</div>
          </div>
        </div>
      </div>
    
      </div>

    </div>
  </div>

  <div class="filters-card bg-secondary plr-4 ptb-2 mb-7" *ngIf="isFilterOpen">
    <div class="row">
      <div class="col-md-3">
        <div class="form-group mb-0">
          <label>{{ "tr_order_number" | translate }}/{{ "tr_phone_number" | translate }}</label>
          <div class="input-with-icon bg-white width-100">
            <input
              class="s-control"
              (keyup)="filterorders($event, 'search')"
              placeholder="{{ 'tr_search' | translate }}"
              [(ngModel)]="nameSearchTerm"
            />
          </div>
        </div>
      </div>
      <div class="col-md-3" *ngIf="curentUser.role == 'Super Admin'">
        <div class="form-group mb-0">
          <label>{{ "tr_branch" | translate }}</label>
          <div class="input-with-icon bg-white width-100">
            <input
              class="s-control"
              (keyup)="filterorders($event, 'searchBranch')"
              placeholder="{{ 'tr_search' | translate }}"
            />
          </div>
        </div>
      </div>
    </div>
  </div>

  <div>
    <div class="plr-4 mt-4" *ngIf="!ordersLoading">
      <div
        class="table-container orders-list"
        id="table-container"
        *ngIf="ordersList.length > 0"
      >
        <table class="s-table table orders-table layout-fixed orders-list">
          <thead>
            <tr>
              <th>{{ "tr_order_number" | translate }}</th>
              <th>{{ "tr_client_name" | translate }}</th>
              <th> {{"tr_phone_number" | translate}}</th>
              <th>{{ "tr_branch" | translate }}</th>
              <th>{{ "tr_number_of_products" | translate }}</th>
              <th>{{ "tr_price" | translate }}</th>
              <th>{{ "tr_payment_method" | translate}}</th>
              <th>{{ "tr_status" | translate}}</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let order of ordersList">
              <td>{{ order.orderNumber }}</td>
              <td>{{ order.clientName }}</td>
              <td>{{ order.clientPhoneNumber}}</td>
              <td>{{ order.branch?.name }}</td>
              <td>{{ order.numberOfProducts }}</td>
              <td>{{ order.totalPrice }}</td>
              <td>{{ order.paymentMethod }}</td>
              <td>{{ order.status }}</td>
              <td>
                <span class="options-menu">
                  <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                  <div class="options-menu-container p-0">
                    <div
                      class="single-option"
                      (click)="restoreOrder( order._id!,order)"
                    >
                      {{ "tr_action.restore" | translate }}
                    </div>
                  </div>
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="empty-state-here text-center ptb-8"
        *ngIf="ordersList.length == 0"
      >
        <img
          class="placeholder-icon"
          src="assets/images/placeholders/announcments.svg"
          alt=""
        />
        <p>{{ "tr_empty_state" | translate }}</p>
      </div>

      <div class="plr-4 ptb-4">
        <pagination
          [paginationData]="paginationData"
          [perPage]="paginationPerPage"
          (paginationUpdate)="paginationUpdate($event)"
        ></pagination>
      </div>
    </div>

    <div *ngIf="ordersLoading">
      <app-ghost-line [length]="12" [type]="'table'"></app-ghost-line>
    </div>
  </div>
</div>
